<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xml:lang="en"><!-- InstanceBegin template="/Templates/DocTemplate.dwt" codeOutsideHTMLIsLocked="false" -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10,IE=Edge" />
    
    <!-- InstanceBeginEditable name="doctitle" -->
<title>Config Property - Security Administration - CPF</title>
    <script type="text/javascript">
pageId = 'configProperty';
    </script>
<!-- InstanceEndEditable -->

    <link
      href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables_themeroller.css"
      rel="stylesheet" type="text/css" />
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/cupertino/jquery-ui.css"
      rel="stylesheet" type="text/css" />
    <link href="../../css/prettify.css" rel="stylesheet" type="text/css" />
    <link href="../../css/rs.css" rel="stylesheet" type="text/css" />
    <link href="../../css/bcgov.css" rel="stylesheet" type="text/css" />
    <link href="../../css/cpf.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
    <script type="text/javascript" src="../../js/prettify.js"></script>
    <script type="text/javascript" src="../../js/rs.js"></script>
    <script type="text/javascript">
$(document).ready(function() {
  prettyPrint();
  setPageId(pageId);
  createToc();
});
	</script>

<!-- InstanceBeginEditable name="head" -->
    <style type="text/css">
td > ul {
  margin: 0px;
}
    </style>
<!-- InstanceEndEditable -->
  </head>
  <body>
    <div class="body">
      <div class="header">
        <div class="headerContent">
          <div class="title">
            Cloud Processing Framework - Developer Guide
           </div>
        </div>
      </div>
      <div class="columns_2_2">
        <div class="columns_2_1">
          <div>
            <div class="column_2_1">
              <div class="sideNav">
                <div class="sideMenu">
                  <div class="title"><a href="http://www.gov.bc.ca/" title="B.C. Home">B.C. Home</a></div>
                  <ul>
                    <li><a href="../../ws/">Home</a></li>
                    <li id="overviewMenu"><a href="../../docs/">Overview</a></li>
                    <li id="clientMenu"><a href="../client/">Client Development</a><ul>
                      <li id="clientRestMenu"><a href="../client/rest-api/">Client REST API</a></li>
                      <li id="clientJavaMenu"><a href="../client/java-api/">Client Java API</a></li>
                     <!-- <li id="clientJavaMenu"><a href="../docs/client/javascript-api/">Client JavaScript API</a></li>-->
                    </ul></li>
                    <li id="pluginMenu"><a href="../plugin/">Plug-in Development</a><ul>
                      <li id="pluginOverviewMenu"><a href="../plugin/overview.html">Plug-in Overview</a></li>
                      <li id="pluginProjectMenu"><a href="../plugin/mavenProject.html">Plug-in Maven Project</a></li>
                      <li id="pluginAppMenu"><a href="../plugin/businessApplication.html">Plug-in Business Application Class</a></li>
                      <li id="pluginCustomizationMenu"><a href="../plugin/customization.html">Plug-in Customization Properties</a></li>
                      <li id="pluginConfigurationMenu"><a href="../plugin/config.html">Plug-in Configuration Properties</a></li>
                      <li id="pluginSecurityMenu"><a href="../plugin/security.html">Plug-in Security</a></li>
                      <li id="pluginTestingMenu"><a href="../plugin/testing.html">Plug-in Testing</a></li>
                      <li id="pluginJavaMenu"><a href="../plugin/java-api/" title="Plug-in Java API">Plug-in Java API</a></li>
                    </ul></li>
                    <li id="installMenu"><a href="../install/">Installation</a><ul>
                      <li id="dbInstallMenu"><a href="../install/database.html">Database Installation</a></li>
                      <li id="webInstallMenu"><a href="../install/webapp.html">Web Application Installation</a></li>
                    </ul></li>
                    <li id="adminMenu"><a href="../admin/">Administration</a><ul>
                      <li id="configPropertyMenu"><a href="configProperty.html">Config Properties</a></li>
                      <li id="userAccountMenu"><a href="userAccount.html">User Accounts</a></li>
                      <li id="userGroupMenu"><a href="userGroup.html">User Groups</a></li>
                      <li id="userGroupPermissionMenu"><a href="userGroupPermission.html">User Group Permissions</a></li>
                    </ul></li>
                  </ul>
                  </div>
              </div>
            </div>
            <div class="column_2_2">
              <div class="bodyContainer">
                <div class="breadcrumbs">
                    <div class="breadcrumb">
<ul>
<li><a href="../../ws/">HOME</a></li>
<li><a href="../../docs/">Developer Guide</a></li>
<!-- InstanceBeginEditable name="crumbs" -->
<li><a href="index.html">Administration</a></li>
<li><a href="security.html">Security</a></li>
<li>Config Property</li>
<!-- InstanceEndEditable -->
</ul>
</div>
                  
                </div>
                <div class="bodyContent">
<!-- InstanceBeginEditable name="body" -->
<div class="title">Config Properties - Administration</div>
<section>
<h1 id="overview">Overview</h1>

<p>The CPF maintains a table of config properties. These config properties are used to authenticate
(login) access to the CPF web services and admin application. The config properties are also used
to assign users to user groups.</p>

<section>
<h2 id="fields">Fields</h2>

<p>The following table summarizes the fields used for config properties.<p>

<div class="simpleDataTable">
<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Config Property Id</td>
      <td>Unique sequence generated primary key for a config property.</td>
    </tr>
    <tr>
      <td>Environment Name</td>
      <td></td>
    </tr>
    <tr>
      <td>Module Name</td>
      <td></td>
    </tr>
    <tr>
      <td>Component Name</td>
      <td></td>
    </tr>
    <tr>
      <td>Property Name</td>
      <td></td>
    </tr>
    <tr>
      <td>Value</td>
      <td></td>
    </tr>
    <tr>
      <td>Value Type</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
</section>

<section>
<h2 id="user_classes">Config Property Classes</h2>

<p>The CPF provides two classes of config property <a href="#user_class_CPF">CPF</a> and <a href="#user_class_BCGOV">BCGOV</a>.</p>
<section>
<h3 id="user_class_CPF">CPF Config Property Class</h3>

<p>The CPF config property class is used to authenticate access resource under /pub/cpf/ws/ and /pub/cpf/admin/.
In the BC Government environments users with the CPF class can be created for applications (as opposed
to end users) who are authorized to use the CPF. These applications use these accounts on the server
side to access the CPF. In this case client JavaScript use is not recommended as there is no way to hide
the consumer key or secret from end-users. In non BC Government environments (e.g. development) these
can be used for end-users or developers.</p>

<p>Each CPF config property has a consumer key (User identifier) and consumer secret (Password/signing key).
These are used by the user when authenticating using one of the following two authentication mechanisms.</p>

<ul>
  <li><a href="http://tools.ietf.org/html/rfc2617">HTTP Digest Access Authentication</a> - Supported by most web browsers</li>
  <li><a href="http://tools.ietf.org/html/rfc5849">OAuth 1.0</a> - Supported by the CPF Java API for direct application access to the CPF.</li>
</ul>

<p>The CPF is installed with the following two accounts defined.</p>

<div class="simpleDataTable">
<table>
  <thead>
    <tr>
      <th>Consumer Key</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cpf_admin</td>
      <td>The initial config property that has access to the CPF admin application. For production
      environments config properties should be created for each admin user (either CPF or BCGOV).
      Those accounts must be added to the ADMIN user group. Once you have been able to login using
      your own admin account the cpf_admin account should be deactivated.</td>
    </tr>
    <tr>
      <td>cpf_worker</td>
      <td>The config property that the CPF worker processes use to connect to the CPF internal web
      service. The name and password of this account can be changed as long as the worker is
      configured to use the new values. Additional worker config properties can be added. These
      accounts must be added to the WORKER user group.</td>
    </tr>
  </tbody>
</table>
</div>
</section>

<section>
<h3 id="user_class_CPF">BCGOV (BC Government Siteminder) Config Property Class</h3>

<p>The BCGOV config property class is used only for the BC Government environments. These accounts
are used to authenticate accss to /pub/cpf/secure/ws/ and /pub/cpf/secure/admin/. The actual authentication
is performed by the Siteminder agent that redirects the user to the BC Government common login page
if the user is not logged in. The user can login using an internal IDIR account or
an external <a href="www.bceid.ca">BCEID</a> account. The config property records are automatically
created after the user has accessed the CPF for the first time. Therefore to assign a user to a group
to a user they must first access any CPF URL under /pub/cpf/secure/.</p>
</section>
</section>
</section>

<section>
<h1 id="management">Config Property Management</h1>

<p>This section describes how to manage user groups and members of those groups.</p>

<p class="note">The user must be in the
ADMIN user group to view the list of all config properties and to manage config properties.</p>

<section>
<h2 id="list">Config Properties List</h2>

<p>The config properties page contains a scrolling table of the config properties. The contents of this 
table can be filtered by typing at least 3 characters in search box. The table will show config properties where
the consumer key, config property class or user name contain those characters characters (ignoring case).</p>

<ol>
  <li>Open the <a href="../../admin/">CPF Admin Application</a>.</li>
  <li>Click the <a href="../../admin/userAccounts/">Config Properties</a> menu item.</li>
</ol>
</section>

<section>
<h2 id="view">View Config Property</h2>

<p>Config properties can be viewed using the following steps.</p>.

<ol>
  <li>Open one of the <a href="list">Config Properties List</a> page.</li>
  <li>Scroll or search for the config property.</li>
  <li>Click the link in the 'Consumer Key' column.</li>
</ol>
</section>

<section>
<h2 id="add">Add Config Property</h2>
<p>New config properties can be added using the following steps. Only accounts with the CPF class can
be added, therefore the Config Property Class field is not shown as it is set to CPF. The created
config property's user name field will be set to the consumer key entered.</p>

<ol>
  <li>Open the <a href="#list">Config Properties List</a> page.</li>
  <li>Click 'Add' button.<ol>
  <li>Edit the field values.<ol>
    <li>Enter a Consumer Key.<ul>
      <li>Must be unique across all consumer keys from all classes.</li>
      <li>Can only contain the characters a-z, 0-9, and _.</li>
      <li>Automatically converted to lower case.</li>
    </ul></li>
    <li>Enter a Password. A random UUID password is provided as a default.</li>
    <li>Select if the user is to be active.</li>
  </ol></li>
  <li>Click the 'Save' button to create the config property,
  'Clear Fields' to undo any changes,
  or 'Cancel' to return to the previous page.</li>
</ol>
</section>

<section>
<h2 id="delete">Delete Config Property</h2>
<p>A config property can be deleted using the following steps. This will also remove the user
account from any user group and delete the user's jobs. For the CPF class deleting accounts is permanent. For BCGOV class this
deletes the record, but a new record will be created when the user next accesses CPF.</p>

<ol>
  <li>Open the <a href="#list">Config Properties List</a> or <a href="#view">View Config Property</a> page.</li>
  <li>Click trash button in the 'Actions' field for the config property to delete.</li>
  <li>Click the 'OK' button on the confirm delete dialog to delete the config property, or 'Cancel' to return to the page.</li>
</ol>
</section>

<section>
<h2 id="edit">Edit Config Property</h2>
<p>Config properties can be edited using the following steps.
For the CPF class the consumer key, consumer secret and active flag can be edited.
For the BCGOV class only the active flag can be edited.</p>

<ol>
  <li>Open the <a href="#view">View Config Property</a> page.</li>
  <li>Click the 'Edit button'.</li>
  <li>Edit the field values.<ol>
    <li>Enter a Consumer Key.<ul>
      <li>Must be unique across all consumer keys from all classes.</li>
      <li>Can only contain the characters a-z, 0-9, and _.</li>
      <li>Automatically converted to lower case.</li>
    </ul></li>
    <li>Enter a Password.</li>
    <li>Select if the user is to be active.</li>
  </ol></li>
  <li>Click the 'Save' button to save changes, 'Revert to Saved' to undo any changes, or 'Cancel' to return to previous page.</li>
</ol>
</section>
</section>
<section>
  <h1 id="properties">Property Names &amp; Descriptions</h1>

<section>
<h2 id="masterFileProperties">Master File Configuration Properties</h2>
<p>The CPF master web application requires the following properties to be defined in the
<code>/apps/config/cpf.properties</code>
<a href="http://docs.oracle.com/javase/7/docs/api/java/util/Properties.html#load(java.io.Reader)">Java Properties</a> file.
<span class="note">Use = not : between the keys and values. Also the : character must be escaped using \:.</span>.
The master will ignore any other properties in this file. So where the master and worker are on
the same machine they can share the same configuration file.</p>

<p class="note">NOTE: The CPF master web application will need to be restarted for these
properties to take affect.</p>

<div class="simpleDataTable">
<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ca.bc.gov.cpf.app.baseUrl</code></td>
      <td>The HTTP URL to the OAuth/Digest secured CPF web services, including context path on the server cpf is deployed to. The trailing / must be omitted.</td>
      <td><a href="http://apps.gov.bc.ca/pub/cpf">http://apps.gov.bc.ca/pub/cpf</a></td>
    </tr>
    <tr>
      <td><code>ca.bc.gov.cpf.app.secureBaseUrl</code></td>
      <td>The HTTPS URL to the Siteminder secured CPF web services, including context path on the server cpf is deployed to. The trailing / must be omitted.</td>
      <td><a href="https://apps.gov.bc.ca/pub/cpf/secure">https://apps.gov.bc.ca/pub/cpf/secure</a></td>
    </tr>
    <tr>
      <td><code>cpfSiteminderLogoutSuccess.logoutUrl</code></td>
      <td>The URL to the siteminder logoff page.</td>
      <td><a href="https://logon.gov.bc.ca/clp-cgi/logoff.cgi">https://logon.gov.bc.ca/clp-cgi/logoff.cgi</a> or
      <a href="https://logontest.gov.bc.ca/clp-cgi/logoff.cgi">https://logontest.gov.bc.ca/clp-cgi/logoff.cgi</a></td>
     </tr>
    <tr>
      <td><code>ca.bc.gov.cpf.db.url</code></td>
      <td>The JDBC URL to the cpf database.</td>
      <td><code>jdbc:oracle:thin:@localhost:1521:cpf</code> or <code>jdbc\:postgresql\://localhost\:5432/cpf</code></td>
    </tr>
    <tr>
      <td><code>ca.bc.gov.cpf.db.password</code></td>
      <td>The password for the PROXY_CPF_WEB user account.</td>
      <td>cpf_2009</td>
    </tr>
    <tr>
      <td><code>ca.bc.gov.cpf.db.maxConnections</code></td>
      <td>The maximum number of database connections.</td>
      <td>50</td>
    </tr>
    <tr>
      <td><code>batchJobService.maxWorkerWaitTime</code></td>
      <td>The maximum time (in seconds) the worker will wait in a HTTP request for group to process before
      trying a new HTTP request. This limits the number of polling requests to the server. Must
      be less than any HTTP server inactivity timeouts.</td>
      <td>100</td>
    </tr>
    <tr>
      <td><code>batchJobService.fromEmail</code></td>
      <td>The email address any emails will be sent from.</td>
      <td>cpf@localhost</td>
    </tr>
    <tr>
      <td><code>mailSender.host</code></td>
      <td>The mail server to send emails via./td>
      <td>localhost</td>
    </tr>
    <tr>
      <td><code>ca.bc.gov.cpf.repositoryServer</code></td>
      <td>The maven repository to download plugins from.</td>
      <td>TODO</td>
    </tr>
    <tr>
      <td><code>ca.bc.gov.cpf.repositoryDirectory</code></td>
      <td>The cache directory to store maven artifacts.</td>
      <td>TODO</td>
    </tr>
  </tbody>
</table>
</div>
</section>

<section>
<h2 id="masterFileProperties">Master Database Configuration Properties</h2>
<p>The CPF master process also supports the following configuration properties that can be
defined in database using the CPF admin application.</p>

<p class="note">NOTE: The CPF master web application will need to be restarted for these
properties to take affect.</p>

<div class="simpleDataTable">
<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>removeOldBatchJobs.daysToKeepOldJobs</td>
      <td>The number of days that jobs will be kept after the results have been created. After
      that time the jobs will be removed in the next daily cleanup.</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>
</section>

<section>
<h2 id="workerFileProperties">Worker File Configuration Properties</h2>
<p>The CPF worker web application requires the following properties to be defined in the
<code>/apps/config/cpf.properties</code>
<a href="http://docs.oracle.com/javase/7/docs/api/java/util/Properties.html#load(java.io.Reader)">Java Properties</a> file.
<span class="note">Use = not : between the keys and values. Also the : character must be escaped using \:.</span>.
The worker will ignore any other properties in this file. So where the worker and master are on
the same machine they can share the same configuration file.</p>

<p class="note">NOTE: The CPF worker web application will need to be restarted for these
properties to take affect.</p>

<div class="simpleDataTable">
<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ca.bc.gov.cpf.internal.webServiceUrl</code></td>
      <td>The HTTP URL to the CPF web services behind any reverse proxies. This is used to speed up
      access from the workers.</td>
      <td><a href="http://localhost/pub/cpf">http://localhost/pub/cpf</a></td>
    </tr>
    <tr>
      <td><code>cpfWorker.password</code></td>
      <td>The password for the cpf_worker user account.</td>
      <td>w0rk3r</td>
    </tr>
    <tr>
      <td><code>cpfWorker.maximumPoolSize</code></td>
      <td>The maximum number of threads on the worker used to execute requests.</td>
      <td>32</td>
    </tr>
  </tbody>
</table>
</div>
</section>
</section>
										<!-- InstanceEndEditable -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="footer">
        <div class="title">Cloud Processing Framework (v ${project.version})</div>
        <div class="footerMenu">
          <ul>
            <li><a href="http://www2.gov.bc.ca/gov/admin/copyright.page" title="COPYRIGHT">COPYRIGHT</a></li>
            <li><a href="http://www2.gov.bc.ca/gov/admin/disclaimer.page" title="DISCLAIMER">DISCLAIMER</a></li>
            <li><a href="http://www2.gov.bc.ca/gov/admin/privacy.page" title="PRIVACY">PRIVACY</a></li>
            <li><a href="http://www2.gov.bc.ca/gov/admin/accessibility.page" title="ACCESSIBILITY">ACCESSIBILITY</a></li>
          </ul>
        </div>
      </div>
    </div>
  </body>
<!-- InstanceEnd --></html>
