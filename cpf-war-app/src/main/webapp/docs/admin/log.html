<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xml:lang="en"><!-- InstanceBegin template="/Templates/DocTemplate.dwt" codeOutsideHTMLIsLocked="false" -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10,IE=Edge" />
    
    <!-- InstanceBeginEditable name="doctitle" -->
<title>Log Files &amp; Diagnostics - Administration - CPF</title>
    <script type="text/javascript">
pageId = 'log';
    </script>
<!-- InstanceEndEditable -->

    <link
      href="https://cdn.datatables.net/keytable/1.2.1/css/dataTables.css"
      rel="stylesheet" type="text/css" />
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/cupertino/jquery-ui.css"
      rel="stylesheet" type="text/css" />
    <link href="../../css/prettify.css" rel="stylesheet" type="text/css" />
    <link href="../../css/rs.css" rel="stylesheet" type="text/css" />
    <link href="../../css/bcgov.css" rel="stylesheet" type="text/css" />
    <link href="../../css/cpf.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.12.0/jquery.validate.min.js"></script>
    <script type="text/javascript" src="../../js/prettify.js"></script>
    <script type="text/javascript" src="../../js/rs.js"></script>
    <script type="text/javascript">
$(document).ready(function() {
  prettyPrint();
  setPageId(pageId);
  createToc();
});
	</script>

<!-- InstanceBeginEditable name="head" -->
    <style type="text/css">
td > ul {
  margin: 0px;
}
    </style>
<!-- InstanceEndEditable -->
  </head>
  <body>
    <div class="body">
      <div class="header">
        <div class="headerContent">
          <div class="title">
            Concurrent Processing Framework - Developer Guide
           </div>
        </div>
      </div>
      <div class="columns_2_2">
        <div class="columns_2_1">
          <div>
            <div class="column_2_1">
              <div class="sideNav">
                <div class="sideMenu">
                  <div class="title"><a href="http://www.gov.bc.ca/" title="B.C. Home">B.C. Home</a></div>
                  <ul>
                    <li><a href="../../ws/">Home</a></li>
                    <li id="overviewMenu"><a href="../../docs/">Overview</a></li>
                    <li id="clientMenu"><a href="../client/">Client Development</a><ul>
                      <li id="clientRestMenu"><a href="../client/rest-api/">Client REST API</a></li>
                      <li id="clientJavaMenu"><a href="../client/java-api/">Client Java API</a></li>
                     <!-- <li id="clientJavaMenu"><a href="../docs/client/javascript-api/">Client JavaScript API</a></li>-->
                    </ul></li>
                    <li id="pluginMenu"><a href="../plugin/">Plug-in Development</a><ul>
                      <li id="pluginOverviewMenu"><a href="../plugin/overview.html">Plug-in Overview</a></li>
                      <li id="pluginProjectMenu"><a href="../plugin/mavenProject.html">Plug-in Maven Project</a></li>
                      <li id="pluginAppMenu"><a href="../plugin/businessApplication.html">Plug-in Business Application Class</a></li>
                      <li id="pluginCustomizationMenu"><a href="../plugin/customization.html">Plug-in Customization Properties</a></li>
                      <li id="pluginConfigurationMenu"><a href="../plugin/config.html">Plug-in Configuration Properties</a></li>
                      <li id="pluginSecurityMenu"><a href="../plugin/security.html">Plug-in Security</a></li>
                      <li id="pluginTestingMenu"><a href="../plugin/testing.html">Plug-in Testing</a></li>
                      <li id="pluginJavaMenu"><a href="../plugin/java-api/" title="Plug-in Java API">Plug-in Java API</a></li>
                    </ul></li>
                    <li id="installMenu"><a href="../install/">Installation</a><ul>
                      <li id="dbInstallMenu"><a href="../install/database.html">Database Installation</a></li>
                      <li id="webInstallMenu"><a href="../install/webapp.html">Web Application Installation</a></li>
                    </ul></li>
                    <li id="adminMenu"><a href="../admin/">Administration</a><ul>
                      <li id="moduleMenu"><a href="module.html">Modules</a></li>
                      <li id="appMenu"><a href="app.html">Business Applications</a></li>
                      <li id="configPropertyMenu"><a href="configProperty.html">Config Properties</a></li>
                      <li id="userAccountMenu"><a href="userAccount.html">User Accounts</a></li>
                      <li id="userGroupMenu"><a href="userGroup.html">User Groups</a></li>
                      <li id="userGroupPermissionMenu"><a href="userGroupPermission.html">User Group Permissions</a></li>
                      <li id="jobsMenu"><a href="job.html">Batch Jobs</a></li>
                      <li id="statisticsMenu"><a href="statistics.html">Dashboard Statistics</a></li>
                      <li id="workersMenu"><a href="worker.html">Workers</a></li>
                      <li id="logMenu"><a href="log.html">Log Files &amp; Diagnostics</a></li>
                    </ul></li>
                  </ul>
                  </div>
              </div>
            </div>
            <div class="column_2_2">
              <div class="bodyContainer">
                <div class="breadcrumbs">
                    <div class="breadcrumb">
<ul>
<li><a href="../../ws/">HOME</a></li>
<li><a href="../../docs/">Developer Guide</a></li>
<!-- InstanceBeginEditable name="crumbs" -->
<li><a href="index.html">Administration</a></li>
<li>Log Files</li>
<!-- InstanceEndEditable -->
</ul>
</div>
                  
                </div>
                <div class="bodyContent">
<!-- InstanceBeginEditable name="body" -->
<div class="title">Log Files &amp; Diagnostics - Administration</div>
<section>
<h1 id="overview">Overview</h1>
<p>The CPF creates additional log files in addition to those created for the Apache web server
and tomcat servlet container. These log files can be accessed on the machine that the master and
worker are running on. These maybe exposed for download via the Apache web server if configured.</p>

<section>
<h2 id="format">Log File Format</h2>
<p>Each log file has lines with the following format, separated by tabs (\t).</p>

<figure>
<pre class="prettyprint">[Date YYYY-MM-DD HH:MI:SS,SSS]\t[Level DEBUG, INFO,WARN, or ERROR]\t[Category]\t[Message]</pre>
</figure>

<p>For example:</p>

<figure>
<pre class="prettyprint">2014-07-30 13:56:16,432 INFO  CPF-TEST  Start Module Start  moduleName=CPF-TEST</pre>
</figure>
</section>

<p>Log entries may also have a <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html#printStackTrace()">java stack trace</a>,
shown on multiple lines. For example.</p>

<figure>
<pre class="prettyprint">2014-07-17 17:08:25,305  ERROR ca.bc.gov.open.cpf.api.scheduler.BatchJobPreProcess Could not open JDBC Connection for transaction; nested exception is java.sql.SQLRecoverableException: IO Error: The Network Adapter could not establish the connection
java.sql.SQLRecoverableException: IO Error: The Network Adapter could not establish the connection
  at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:458)
  at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:546)
  at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:236)
  at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)
  at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:521)
  at oracle.jdbc.pool.OracleDataSource.getPhysicalConnection(OracleDataSource.java:280)
  at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:207)
  at oracle.jdbc.pool.OracleConnectionPoolDataSource.getPhysicalConnection(OracleConnectionPoolDataSource.java:139)
  at oracle.jdbc.pool.OracleConnectionPoolDataSource.getPooledConnection(OracleConnectionPoolDataSource.java:88)
  at oracle.jdbc.pool.OracleImplicitConnectionCache.makeCacheConnection(OracleImplicitConnectionCache.java:1598)
  at oracle.jdbc.pool.OracleImplicitConnectionCache.makeOneConnection(OracleImplicitConnectionCache.java:515)
  at oracle.jdbc.pool.OracleImplicitConnectionCache.getCacheConnection(OracleImplicitConnectionCache.java:475)
  at oracle.jdbc.pool.OracleImplicitConnectionCache.getConnection(OracleImplicitConnectionCache.java:357)
  at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:395)
  at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:179)
  at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:157)
  ... 13 more
Caused by: oracle.net.ns.NetException: The Network Adapter could not establish the connection
  at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:392)
  at oracle.net.resolver.AddrResolution.resolveAndExecute(AddrResolution.java:434)
  at oracle.net.ns.NSProtocol.establishConnection(NSProtocol.java:687)
  at oracle.net.ns.NSProtocol.connect(NSProtocol.java:247)
  at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1102)
  at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:320)
  ... 29 more
Caused by: java.net.SocketTimeoutException: connect timed out
  at java.net.PlainSocketImpl.socketConnect(Native Method)
  at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
  at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
  at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
  at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
  at java.net.Socket.connect(Socket.java:579)
  at oracle.net.nt.TcpNTAdapter.connect(TcpNTAdapter.java:150)
  at oracle.net.nt.ConnOption.connect(ConnOption.java:133)
  at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:370)
  ... 34 more
</pre>
</figure>

<section>
<h2 id="files">Log Files</h2>

<p>The following table summarizes the log files created by the CPF.
The log files by default are stored in <code>/apps/logs/cpf/</code>.
Each module and business application has separate directories for their log files. Log files will
be rolled over once they reach 10MB. The last 7 log files will be retained with extensions <code>.[i].log</code> (e.g. <code>.2.log</code>).</p>

<div class="simpleDataTable">
  <table>
    <thead>
      <tr>
        <th>File</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>catalina.out</code></td>
        <td><p>If running on tomcat the tomcat server log file. Exact file name and location will vary
        based on the servlet container used and it's configuration. If the CPF does not start check this
        log file for any errors.</p></td>
      </tr>
      <tr>
        <td><code>cpf-app.log</code></td>
        <td><p>Log messages for components on the master not related to a module or a business application.
        New log file created on module restart or if &gt; 10MB. Previous 7 log files retained with extensions .[1-7].log (e.g. .1.log).</p></td>
      </tr>
      <tr>
        <td><code>worker_[environmentName]_[hostName]_[port]_[contextPath].log</code></td>
        <td><p>Log messages for components on the worker not related to a module or a business application.
        New log file created on module restart or if &gt; 10MB. Previous 7 log files retained with extensions .[1-7].log (e.g. .1.log).</p></td>
      </tr>
      <tr>
        <td><pre>[moduleName]/
  [moduleName]_master.log</pre></td>
        <td><p>Log messages for a module's components on the master not related to a business application.
        New log file created on module restart or if &gt; 10MB. Previous 7 log files retained with extensions .[1-7].log (e.g. .1.log).</p></td>
      </tr>
      <tr>
        <td><pre>[moduleName]/
  [moduleName]_worker_[environmentName]_[hostName]_[port]_[contextPath].log</pre></td>
        <td><p>Log messages for a module's components on the worker not related to a business application.
        New log file created on module restart or if &gt; 10MB. Previous 7 log files retained with extensions .[1-7].log (e.g. .1.log).</p></td>
      </tr>
      <tr>
        <td><pre>[moduleName]/
  [appName]/
    [moduleName]_[appName]_master.log</<pre></td>
        <td><p>Log messages for a business application's components on the master.
        New log file created on module restart or if &gt; 10MB. Previous 7 log files retained with extensions .[1-7].log (e.g. .1.log).</p></td>
      </tr>
      <tr>
        <td><pre>[moduleName]/
  [appName]/
    [moduleName]_[appName]_worker_[environmentName]_[hostName]_[port]_[contextPath].log</pre></td>
        <td><p>Log messages for a business application's components on the worker.
        New log file created on module restart or if &gt; 10MB. Previous 7 log files retained with extensions .[1-7].log (e.g. .1.log).</p></td>
      </tr>
    </tbody>
  </table>
</div>
</section>

</section>
<section>
  <h1 id="diagnostics">Diagnosing Issues</h1>
<p>This section describes how to diagnose issues with the CPF system or plug-ins running within the
system.</p>

<p>The first step in diagnosing an issue is to detect if it is a plug-in specific issue that must
be reported to the plug-in developer or a general CPF issue that must be reported to the CPF
developer. The general rule is check to see if the problem is isolated to this plug-in by submitting
jobs to other plug-ins (e.g. MapTileByTileId). <b>If the error is specific to a single plug-in then
contact the plug-in developer for resolution first. Only contact the CPF developer if the plug-in
developer cannot resolve the issue.</b></p>

<section>
<h2 id="serverErrors">Server Errors</h2>
<p>Sometimes the server will return an error page instead of a valid page. The CPF returns a
formatted and styled error page similar to as shown below. This kind of error is generated by the
CPF application. If the server returns an unformatted page (black text on white background) then
this is an error generated by the web server. For example the application server was down, or the
CPF was not deployed. Those errors must be reported to the server administrator.</p>

<figure>
<img src="error.png" />
</figure>

<section>
<h3 id="400">400 Bad Data</h3>
<p>If the input data to the web service was incorrect the CPF may return a 400 error with a message
about the invalid parameter. Check the parameters are correct using the
<a href="../client/rest-api">Client REST API</a> or the Overview tab for the business application.
If the issue can't be resolved by reading the documentation. contact the plug-in developer for
business application specific parameters or the CPF developer for general CPF parameters.</p>
</section>

<section>
<h3 id="404">404 Not Found</h3>
<p>This error indicates that the resource could not be found. Verify that the plug-in is loaded,
the resource exists (e.g. correct job id and hasn't been deleted), or that the correct URL is used.</p>
</section>

<section>
<h3 id="500">500 Server Error</h3>
<p>This error indicates an unknown error has occurred on the server. Verify that the error can be repeated.
Check the cpf-app.log or catalina.out log files for more details. The contents of these files should
be sent to the CPF developer with a detailed description of the steps (pages) and parameters used
to generate the error.</p>

<p>It may be possible to diagnose and resolve the following types of error without contacting the
CPF developer.</p> 
<ul>
  <li><code>java.io.IOException</code> subclasses<ul>
  <li>If the error is a broken pipe within a tomcat/catalina stack
  trace then it's probably that the connection from the web browser to the CPF process was disconnected.
  Not much can be done except increasing the timeouts for communications between the apache and tomcat servers.
  </li>
  <li>If the error is a file not found, permission denied, out of disk space error then verify the
  server configuration and check available disk space.</li>
  </ul></li>
  <li><code>java.sql.SQLException</code> subclasses<ul>
  <li>Check the error code/message to verify if it is an invalid username or password or for password expiry.
  Update the passwords or configuration as required.</li>
  <li>Check the error code/message to verify that the database server is available. It might be down for a cold
  backup, daily restart or maintenance. Verify the JDBC URL to check it's pointing to the correct server</li>
  <li>Check the error code/message to verify if the database server was out of tablespace storage. Delete old jobs
  or increase the storage as required.</li>
  <li>Check the error code/message to verify if it's an invalid SQL statement. If it is contact the CPF developer
  if it has CPF has a table schema name in the SQL, otherwise contact the plug-in developer.</li>
  </ul></li>
  <li><code>java.lang.OutOfMemoryError</code> This could occur if the request data is to large to fit into
  memory or if the plug-ins or CPF has been re-dployed too many times and is not being garbage collected (perm gen errors).
  Typically this error will show up in the catalina.out file. Rebooting the application server is the best
  way to resolve these issues. If the error occurs repeatedly then 
  verify that the <code>-Xmx</code> option for tomcat is large enough for the business applications and for perm gen
  errors check the <code>-XX:MaxPermSize</code> option. The CPF and plug-ins should be developed so
  that they can be garbage collected when stopped or restarted. Details on this are in the <a href="../client/">client
  developers guide</a>.</li>
  <li><code>org.springframework.security.authentication.*Exception</code> This indicates that the
  user is not valid or does not have permission to access the resource. Contact the CPF developer
  as these should not be logged in the log file and just displayed to the user.</li>
</ul>
</section>

</section>


<section>
<h2 id="pluginStarted">Verify Plug-in Started</h2>
<p>Use the following steps to verify that the plug-in is started on the master or worker.</p>

<ul>
  <li>Check that the plug-in is enabled and started on the master using the <a href="module.html#view">View Module</a> page.<ul>
    <li>Enable the module if it is not enabled.</li>
    <li>Start the module if not started.</li>
    <li>If there is a module error:<ul>
      <li>Check the master module log file <code>[moduleName]/[moduleName]_master.log</code> for more details on the error.</li>
      <li>Check the configuration properties using the plug-ins documentation to verify they are correct.
      Especially check database URL, username and password.</li>
      <li>Check that the Maven Module Id is correct. Fix and start module if incorrect.</li>
      <li>If there is a Maven error downloading files verify that the Maven repository has all the
      required modules for the plug-in. Clear the CPF cache if necessary to reset the system.
      Verify using a web browser that the Maven modules exist in the Maven repository and can be downloaded.
      If not contact the Maven repository administrator.</li>
    </ul></li>
  </ul></li>
  <li>Check there is a worker connected using the <a href="worker.html#list">Worker List</a> page.</li>
  <li>Check the module is started using the <a href="worker.html#moduleList">Worker Module List</a> page.</li>
  <li>If not started check for module errors using the <a href="worker.html#moduleView">Worker Module View</a> page.</li>
  <li>Check the worker module log file <code>[moduleName]/[moduleName]_worker_[environmentName]_[hostName]_[port]_[contextPath].log</code> for more details on the error.
</ul>

<p>If the plug-in loaded successfully
the master module log file <code>[moduleName]/[moduleName]_master.log</code> and
worker module log file <code>[moduleName]/[moduleName]_worker_[environmentName]_[hostName]_[port]_[contextPath].log</code>
will be rolled over and the following entries will appear at the top of the log file.</p>

<figure>
<pre class="prettyprint">
2014-07-30 16:28:24,183 INFO  [Module Name]  Start Module Start    moduleName=[Module Name]
2014-07-30 16:28:24,200 INFO  [Module Name]  Start Loading plugin  class=[businessApplicationClass]
2014-07-30 16:28:24,212 INFO  [Module Name]  End Loading plugin    class=[businessApplicationClass]  businessApplicationName=[businessApplicationName]
2014-07-30 16:28:24,238 INFO  [Module Name]  End Module Start      moduleName=[Module Name] time=0.06
</pre>
</figure>

</section>

<section>
<h2 id="jobSubmission">Job Submission</h2>
<p>Use the following steps if experiencing difficulty accessing the business application pages
and in submitting instant, single or multiple request jobs.</p>

<ul>
  <li>Using above verify the plug-in for the business application is started.</li>
  <li>Verify the business application is available on the <a href="../../ws/#businessApplication_clientList">Business Application</a> page.
  Refresh if necessary. If it does not appear in the list then the plug-in does not exist (contact plug-in developer) or is not loaded.</li>
  <li>Click on the name of the business application and verify that the Overview,
  Create Single Request Job, Create Multi-Request Job and Batch Job Tabs are available. If the plug-in
  supports instant mode check the 'Instant' tab is visible. Click on each tab to verify it is
  displayed correctly.</li>
  <li>Use the Create Single Request Job and Create Multi-Request Job tabs to verify that a job can be submitted.<ul>
    <li>If the job status page was returned then the job was submitted correctly.</li>
    <li>If you get a red error message at the top of the form or next to a field then the parameters were incorrect.
    Verify the parameters used. Consult the Overview tab for more details or the plug-in developer.</li>
    <li>If the size of a mult-request job file and other form parameters exceed 20MB then a 400 error will be returned.
    Use the URL upload instead.</li>
    <li>If a 400 error is returned check the input parameters to see if they are valid. Contact the
    plug-in developer for application specific parameters or the CPF developer for general parameters.</li>
    <li>If a 500 error is returned check the cpf-appl.log for errors and send the log file to the CPF developer.</li>
  </ul></li>
</ul>
</section>

<section>
<h2 id="jobProcessing">Job Processing</h2>
<p>If the job was submitted but is not completed in the exepcted time check the following.</p>

<ul>
  <li>Check the module is loaded on the worker using the <a href="worker.html#moduleView">Worker Module View</a> page.
  Some modules may take 30 minutes to initialize after restart on the worker</li>
  <li>Submit jobs to another business application so see if the system generally works.</li>
  <li>If the job is stuck in the creatingRequests or creatingResults states check the master module and app log file for any errors.
  If the error was due to out of memory or database space allocate more space or cancel the job.
  Otherwise send the errors to the CPF developer for review, don't cancel delete the job until it has been investigated.</li>
  <li>If the job is stuck in the processing stage check the master and worker module and app log files for any errors.
  Send to the CPF developer for review.</li>
  <li>Additional information about the scheduling and execution of execution groups and requests can be enabled by
  <a href="app.html#edit">Edit Business Application</a> to turn on Debug level logging for the business application.
  <b>NOTE: Change back to ERROR logging after the problem is diagnosed as the logs can get large and slow down the system.</b></li>
</ul>
</section>

</section>

										<!-- InstanceEndEditable -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="footer">
        <div class="title">Concurrent Processing Framework (v ${project.version})</div>
        <div class="footerMenu">
          <ul>
            <li><a href="http://www2.gov.bc.ca/gov/admin/copyright.page" title="COPYRIGHT">COPYRIGHT</a></li>
            <li><a href="http://www2.gov.bc.ca/gov/admin/disclaimer.page" title="DISCLAIMER">DISCLAIMER</a></li>
            <li><a href="http://www2.gov.bc.ca/gov/admin/privacy.page" title="PRIVACY">PRIVACY</a></li>
            <li><a href="http://www2.gov.bc.ca/gov/admin/accessibility.page" title="ACCESSIBILITY">ACCESSIBILITY</a></li>
          </ul>
        </div>
      </div>
    </div>
  </body>
<!-- InstanceEnd --></html>
